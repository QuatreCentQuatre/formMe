"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}var FormManager=function(){function t(e){_classCallCheck(this,t),this.name="FormManager",this.defaults={},this.forms=[],this.options={},this.setOptions(e)}return _createClass(t,[{key:"setOptions",value:function(e){this.options=Object.assign(this.options,this.defaults,e)}},{key:"initForms",value:function(e){var t=0<arguments.length&&void 0!==e?e:$("html");this.clearForms();for(var i=t.find("[me\\:form]"),n=[],a=0;a<i.length;a++){var s,r=$(i[a]),o=r.attr("me:form"),l={el:r[0],name:o,params:{}};"function"==typeof Me.forms[o]?r.attr("me:form:render")||(r.attr("me:form:render","true"),s=new Me.forms[o](l),this.forms.push(s),n.push(s)):console.warn("You need to have form that exist.",o)}for(var h=0;h<n.length;h++)n[h].initialize()}},{key:"clearForms",value:function(){var e=[];for(var t in this.forms){var i=this.forms[t];"object"==_typeof(i.$el)&&(0<$("html").find(i.$el[0]).length?e.push(i):i.terminate())}this.forms=e}},{key:"name",get:function(){return this._name},set:function(e){this._name=e}}]),t}();window.Me||(window.Me={}),Me.formManager=new FormManager,Me.forms=[],$(document).ready(function(){Me.formManager.initForms()});var FormBase=function(){function t(e){_classCallCheck(this,t),this.classes={valid:"is-valid",invalid:"is-invalid",error:"has-error",serverError:"has-server-error",serverSuccess:"has-server-success"},this.el=e.el,this.$el=$(e.el),this.params=e.params?e.params:{},this.$submit=0<this.$el.find("[me\\:form\\:submit]").length?this.$el.find("[me\\:form\\:submit]"):this.$el.find('[type="submit"]'),this.name=e.name?e.name:"FormBasic",this.fields=[],this.ajax=!!this.$el.attr("ajax"),this.method=this.$el.attr("method"),this.action=this.$el.attr("action"),this.dataType="json",this.antiSpam=!1,this.initialized=!1,this.options={debug:!(!window.SETTINGS||!SETTINGS.DEBUG_MODE)&&SETTINGS.DEBUG_MODE}}return _createClass(t,[{key:"initialize",value:function(){var i=this;this.dependenciesExist()&&this.requirementsExit()&&(this.validation=new ValidateMe(this),this.fields.forEach(function(e,t){i.addField(e)}),this.addEvents(),this.initialized=!0)}},{key:"addEvents",value:function(){var t=this;this.$submit&&this.$submit.on("click.formMe",function(e){t.submitHandler(e)}),this.$el.on("submit.formMe",function(e){t.submitHandler(e)})}},{key:"removeEvents",value:function(){this.$submit&&this.$submit.off("click.formMe"),this.$el.off("submit.formMe")}},{key:"addField",value:function(t){this.fields.findIndex(function(e){return e.name===t.name})<0?this.fields.push(t):this.initialized&&console.warn("This field already exist",t),this.validation.addField(t)}},{key:"removeField",value:function(t){this.getField(t)&&(this.fields.splice(this.fields.findIndex(function(e){return e.name===t}),1),this.validation.removeField(t))}},{key:"getField",value:function(t){return this.fields.find(function(e){return e.name===t})}},{key:"submitHandler",value:function(e){this.antiSpam||(this.antiSpam=!0,this.ajax&&e&&e.preventDefault(),this.validation.validate()||e.preventDefault())}},{key:"onValidationSuccess",value:function(e){var i=this;e.forEach(function(e,t){i.handleValidationSuccessField(e)}),this.$el.removeClass(this.classes.invalid).addClass(this.classes.valid),this.ajax&&this.handleAjaxSend(this.formatFormData(this.validation.fields))}},{key:"onValidationError",value:function(e,t){var i=this;e.forEach(function(e,t){i.handleValidationSuccessField(e)}),t.forEach(function(e,t){i.handleValidationErrorField(e)}),this.$el.addClass(this.classes.invalid),this.antiSpam=!1}},{key:"handleValidationSuccessField",value:function(e){e.error&&e.error.addClass("hide").attr("aria-hidden",!0),e.$el.removeClass(this.classes.error)}},{key:"handleValidationErrorField",value:function(e){e.error&&e.error.removeClass("hide").attr("aria-hidden",!1),e.$el.addClass(this.classes.error)}},{key:"handleAjaxSend",value:function(e){var t=this;$.ajax({method:this.method,url:this.action,data:e,dataType:this.dataType,processData:!1,cache:!1,contentType:!1,success:function(e){t.ajaxSuccess(e)},error:function(e){t.ajaxError(e)},complete:function(){t.ajaxComplete()}})}},{key:"ajaxSuccess",value:function(e){"json"===this.dataType&&0===Object.entries(e).length&&console.warn("No values returned by the service."),this.reset(),this.$el.removeClass(this.classes.serverError).addClass(this.classes.serverSuccess)}},{key:"ajaxError",value:function(){this.$el.removeClass(this.classes.serverSuccess).addClass(this.classes.serverError)}},{key:"ajaxComplete",value:function(){this.antiSpam=!1}},{key:"formatFormData",value:function(e){var s=new FormData;return e.forEach(function(e,t){var i=$('[name="'.concat(e.name,'"]'));""===e.value||i.disabled||"file"===e.type||s.append(e.name,e.value)}),this.fields.forEach(function(e,t){if(null!=e.file_type){var i=$('[name="'.concat(e.name,'"]'));if(i[0].files[0]){var n=[];for(var a in i[0].files)i[0].files[a].name&&i[0].files[a].size&&n.push(i[0].files[a]);s.append(e.name,n)}}}),s}},{key:"dependenciesExist",value:function(){var e=!0;return window.$||(e=!1,console.error("Form ".concat(this.name," needs Jquery."))),window.Me&&window.Me.validate||(e=!1,console.error("Form ".concat(this.name," needs ValidateMe (https://github.com/QuatreCentQuatre/validateMe/)"))),e}},{key:"requirementsExit",value:function(){var e=!0;if(0<!this.$el.length&&(e=!1,console.error("Couldn't find associated form name",this.name)),this.method||(e=!1,console.error("".concat(this.name," needs to have a method"))),this.action||(e=!1,console.error("".concat(this.name," needs to have an action attribute"))),this.fields&&!(this.fields&&this.fields.length<=0))return 0<!this.$submit.length&&(e=!1,console.error("".concat(this.name," needs to have a submit button"))),e;console.error("".concat(this.name," needs a list of fields. To see what you need to add go check de README.md"))}},{key:"reset",value:function(){return this.validation.reset(),this}},{key:"terminate",value:function(){this.removeEvents()}},{key:"name",set:function(e){"string"==typeof e?this._name=e:console.error("The name parameter must be a string")},get:function(){return this._name}},{key:"dataType",set:function(e){"string"==typeof e?this._dataType=e:console.error("The dataType parameter must be a string")},get:function(){return this._dataType}},{key:"ajax",set:function(e){"boolean"==typeof e?this._ajax=e:console.error("The bool parameter must be a boolean")},get:function(){return this._ajax}},{key:"method",set:function(e){"string"==typeof e?this._method=e:console.error("The method parameter must be a string")},get:function(){return this._method}},{key:"action",set:function(e){"string"==typeof e?this._action=e:console.error("The method parameter must be a string")},get:function(){return this._action}},{key:"antiSpam",set:function(e){"boolean"==typeof e?this._antiSpam=e:console.error("The bool parameter must be a boolean")},get:function(){return this._antiSpam}},{key:"fields",set:function(e){"object"!==_typeof(e)&&0<e.length?console.error("The fields parameter must be an array"):this._fields=e},get:function(){return this._fields}},{key:"initialized",set:function(e){this._initialized=e},get:function(){return this._initialized}}]),t}();Me.forms.FormBase=FormBase;